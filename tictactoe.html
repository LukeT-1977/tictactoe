
<html>
<head>
    <style>
        button {
            width: 50px;
            height: 50px;
        }
    </style>

    <script>
        var a = [ // array to keep track of status of each square
            [0, 0, 0],
            [0, 0, 0],
            [0, 0, 0]
        ];
        var gameComplete = false;

        function buttonClicked() {
            if (gameComplete) {
                return;
            }

            id = event.target.id
            x = id.charAt(0);
            y = id.charAt(1);
            
            if (a[x][y] == 0) {
                document.getElementById(id).innerHTML = "X";
                a[x][y] = 1;
                console.log("User: " + id);
                checkGame();
                theirMove();
            } else {
                document.getElementById("moveIndicator").innerHTML = "Space already taken!";
            }
        }

        function theirMove() {
            if (gameComplete) {
                return;
            }

            document.getElementById("moveIndicator").innerHTML = "Their move...";

            id = tryMove()
            if (id == null) { // place random, couldn't find any potential rows/columns
                    do {
                    x = Math.floor(Math.random() * 3);
                    y = Math.floor(Math.random() * 3);
                    id = x + "" + y;
                    console.log("Trying " + id + "...");
                } while (a[x][y] != 0) 
            }
            
            x = id.charAt(0);
            y = id.charAt(1);

            console.log("Computer: " + id);
            document.getElementById(id).innerHTML = "O";
            a[x][y] = -1;

            checkGame();

            document.getElementById("moveIndicator").innerHTML = "Your move...";
            
        }

        function tryMove() {
            // TODO implement diagonal
            
            // search for lines it can complete
            // prioritise lines of Os (team -1) then of Xs (team 1)
            for (var team = 1; team >= 0; team--) {
                console.log("team: " + team);
                for (var i = 0; i < 3; i++) {
                    for (var j = 0; j < 3; j++) {
                        if (a[i][j] == a[i][(j+1) % 3] && a[i][j] == (-1)^team && a[i][(j+2) % 3] == 0) {
                            id = i + "" + (j+2) % 3;
                            return id;
                        }
                        if (a[j][i] == a[(j+1) % 3][i] && a[j][i] == (-1)^team && a[(j+2) % 3][i] == 0) {
                            id = (j+2) % 3 + "" + i;
                            return id;
                        }
                    }
                }
            }

            // search for Os it can make lines out of
            for (var i = 0; i < 3; i++) {
                console.log("O search");
                for (var j = 0; j < 3; j++) {
                    if (a[i][j] == -1 && a[i][(j+1) % 3] == a[i][(j+2) % 3] && a[i][(j+2) % 3] == 0) {
                        id = i + "" + (j+1) % 3;
                        return id;
                    }
                    if (a[j][i] == -1 && a[(j+1) % 3][i] == a[(j+2) % 3][i] && a[(j+2) % 3][i]== 0) {
                        id = (j+1) % 3 + "" + i;
                        return id;
                    }
                }
            }
            return null;
        }

        function checkGame() {
            for (i = 0; i < 3; i++) {
                    if (a[i][0] == a[i][1] && a[i][1] == a[i][2] && a[i][0] != 0) {
                        alert("Row victory for team " + a[i][0]);
                        gameComplete = true;
                    }
                    if (a[0][i] == a[1][i] && a[1][i] == a[2][i] && a[0][i] != 0) {
                        alert("Column victory for team " + a[0][i]);
                        gameComplete = true;
                    }
            }
            if (a[0][0] == a[1][1] && a[1][1] == a[2][2] && a[0][0] != 0) {
                alert("Left-diagonal victory for team " + a[0][0]);
                gameComplete = true;
            }
            if (a[0][2] == a[1][1] && a[1][1] == a[2][0] && a[0][2] != 0) {
                alert("Right-diagonal victory for team " + a[0][2]);
                gameComplete = true;
            }
        }
    </script>

</head>

<body>
    <h1>Tic-Tac-Toe</h1>
    <h3 id="moveIndicator">Your move...</h3>
    <table>
        <tr>
            <td>
                <button id="00" onclick="buttonClicked()"></button>
            </td>
            <td>
                <button id="01" onclick="buttonClicked()"></button>
            </td>            
            <td>
                <button id="02" onclick="buttonClicked()"></button>
            </td>        
        </tr>
        <tr>
            <td>
                <button id="10" onclick="buttonClicked()"></button>
            </td>            
            <td>
                <button id="11" onclick="buttonClicked()"></button>
            </td>            
            <td>
                <button id="12" onclick="buttonClicked()"></button>
            </td>        
        </tr>
        <tr>
            <td>
                <button id="20" onclick="buttonClicked()"></button>
            </td>            
            <td>
                <button id="21" onclick="buttonClicked()"></button>
            </td>            
            <td>
                <button id="22" onclick="buttonClicked()"></button>
            </td>        
        </tr>
    </table>
</body>